<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±å…¥äº†è§£ - Transformeræ¶æ„</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="top-header">
        <div class="logo">
            <span class="logo-icon">ğŸ¤–</span>
            <span class="logo-text">ç”Ÿæˆå¼AIå…¥é—¨è¯¾ç¨‹</span>
        </div>
    </header>

    <main class="deep-page">
        <div class="deep-header">
            <a href="../index.html#ch04" class="back-btn">
                <span>â†</span>
                <span>è¿”å›è¯¾ç¨‹é¦–é¡µ</span>
            </a>
        </div>

        <h1 class="deep-title">æ·±å…¥äº†è§£ï¼šTransformeræ¶æ„</h1>

        <div class="deep-content">
            <h2>è‡ªæ³¨æ„åŠ›æœºåˆ¶å¯è§†åŒ–</h2>
            <p>ç‚¹å‡»ä»»æ„è¯è¯­ï¼ŒæŸ¥çœ‹å®ƒä¸å…¶ä»–è¯è¯­çš„æ³¨æ„åŠ›æƒé‡ï¼š</p>

            <div id="attentionViz" style="background: var(--bg-tertiary); padding: 30px; border-radius: 10px; margin: 20px 0;">
                <div id="sentence" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px;">
                </div>
                <div id="attentionMatrix" style="overflow-x: auto;">
                    <div id="attentionBars" style="display: flex; gap: 10px; align-items: flex-end; height: 200px; padding: 20px; background: white; border-radius: 8px; min-width: 500px;">
                    </div>
                </div>
            </div>

            <h2>å¤šå¤´æ³¨æ„åŠ›æ¼”ç¤º</h2>
            <p>åŒä¸€ä¸ªå¥å­ï¼Œä¸åŒçš„æ³¨æ„åŠ›å¤´å…³æ³¨ä¸åŒçš„æ–¹é¢ï¼š</p>

            <div style="background: var(--bg-tertiary); padding: 25px; border-radius: 10px; margin: 20px 0;">
                <div style="text-align: center; font-size: 1.1rem; margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                    "The bank of the river" vs "The bank with money"
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: var(--primary-color);">ğŸ”¤ å¤´1ï¼šè¯­æ³•å…³ç³»</div>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">å…³æ³¨è¯æ€§ã€å¥æ³•ç»“æ„</p>
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-light);">bank â†’ åè¯</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: var(--secondary-color);">ğŸŒŠ å¤´2ï¼šè¯­ä¹‰è§’è‰²</div>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">å…³æ³¨"river"è¯­å¢ƒ</p>
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-light);">bank â†” river å¼ºå…³è”</div>
                    </div>
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: 600; margin-bottom: 10px; color: var(--accent-color);">ğŸ’° å¤´3ï¼šä¸Šä¸‹æ–‡</div>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">å…³æ³¨"money"è¯­å¢ƒ</p>
                        <div style="margin-top: 10px; font-size: 0.85rem; color: var(--text-light);">bank â†” money å¼ºå…³è”</div>
                    </div>
                </div>
            </div>

            <h2>ä½ç½®ç¼–ç åŸç†</h2>
            <p>Transformerå¦‚ä½•çŸ¥é“è¯è¯­çš„é¡ºåºï¼Ÿ</p>

            <div class="info-box">
                <h3>æ­£å¼¦/ä½™å¼¦ä½ç½®ç¼–ç å…¬å¼ï¼š</h3>
                <div style="background: #1e293b; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: monospace; margin: 15px 0;">
                    PE(pos, 2i) = sin(pos / 10000^(2i/d))<br>
                    PE(pos, 2i+1) = cos(pos / 10000^(2i/d))
                </div>
                <p>å…¶ä¸­ pos æ˜¯ä½ç½®ï¼Œi æ˜¯ç»´åº¦ç´¢å¼•ã€‚è¿™ç§è®¾è®¡è®©æ¨¡å‹èƒ½è½»æ¾å­¦ä¼šç›¸å¯¹ä½ç½®å…³ç³»ã€‚</p>
            </div>

            <h2>ç¼–ç å™¨ vs è§£ç å™¨ vs ä¸¤è€…å…¼æœ‰</h2>

            <table style="width:100%; border-collapse: collapse; margin: 20px 0;">
                <tr style="background: var(--bg-tertiary);">
                    <th style="padding: 12px; border: 1px solid var(--border-color);">ç±»å‹</th>
                    <th style="padding: 12px; border: 1px solid var(--border-color);">ä»£è¡¨æ¨¡å‹</th>
                    <th style="padding: 12px; border: 1px solid var(--border-color);">æ“…é•¿ä»»åŠ¡</th>
                    <th style="padding: 12px; border: 1px solid var(--border-color);">ç‰¹ç‚¹</th>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ä»…ç¼–ç å™¨</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">BERT, RoBERTa</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ç†è§£ä»»åŠ¡</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">åˆ†ç±»ã€æ ‡æ³¨ã€NER</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ä»…è§£ç å™¨</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">GPTç³»åˆ—, Llama</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ç”Ÿæˆä»»åŠ¡</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">æ–‡æœ¬ç”Ÿæˆã€å¯¹è¯</td>
                </tr>
                <tr>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ç¼–ç å™¨-è§£ç å™¨</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">T5, BART</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">åºåˆ—è½¬æ¢</td>
                    <td style="padding: 12px; border: 1px solid var(--border-color);">ç¿»è¯‘ã€æ‘˜è¦</td>
                </tr>
            </table>

            <h2>ç« èŠ‚æµ‹éªŒ</h2>

            <div class="quiz-container" data-quiz-id="ch04-quiz-1">
                <div class="quiz-question">1. Transformerçš„æ ¸å¿ƒåˆ›æ–°æ˜¯ä»€ä¹ˆï¼Ÿ</div>
                <div class="quiz-options">
                    <label class="quiz-option">
                        <input type="radio" name="ch04q1" value="0" class="quiz-radio">
                        <span>RNNï¼ˆå¾ªç¯ç¥ç»ç½‘ç»œï¼‰</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q1" value="1" class="quiz-radio">
                        <span>è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q1" value="2" class="quiz-radio">
                        <span>å·ç§¯ç¥ç»ç½‘ç»œ</span>
                    </label>
                </div>
                <button class="submit-quiz-btn">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback"></div>
            </div>

            <div class="quiz-container" data-quiz-id="ch04-quiz-2">
                <div class="quiz-question">2. Transformerç›¸æ¯”RNNçš„ä¸»è¦ä¼˜åŠ¿æ˜¯ï¼Ÿ</div>
                <div class="quiz-options">
                    <label class="quiz-option">
                        <input type="radio" name="ch04q2" value="0" class="quiz-radio">
                        <span>å¯ä»¥é€å­—é¡ºåºé˜…è¯»</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q2" value="1" class="quiz-radio">
                        <span>å¹¶è¡Œå¤„ç†ï¼Œé€Ÿåº¦æ›´å¿«</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q2" value="2" class="quiz-radio">
                        <span>å ç”¨å†…å­˜æ›´å°‘</span>
                    </label>
                </div>
                <button class="submit-quiz-btn">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback"></div>
            </div>

            <div class="quiz-container" data-quiz-id="ch04-quiz-3">
                <div class="quiz-question">3. å¤šå¤´æ³¨æ„åŠ›çš„ä½œç”¨æ˜¯ï¼Ÿ</div>
                <div class="quiz-options">
                    <label class="quiz-option">
                        <input type="radio" name="ch04q3" value="0" class="quiz-radio">
                        <span>è®©æ¨¡å‹ä¸€æ¬¡å…³æ³¨ä¸€ä¸ªè¯</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q3" value="1" class="quiz-radio">
                        <span>ä»å¤šä¸ªä¸åŒè§’åº¦åŒæ—¶åˆ†æä¿¡æ¯</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q3" value="2" class="quiz-radio">
                        <span>å¢åŠ æ¨¡å‹å‚æ•°é‡</span>
                    </label>
                </div>
                <button class="submit-quiz-btn">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback"></div>
            </div>

            <div class="quiz-container" data-quiz-id="ch04-quiz-4">
                <div class="quiz-question">4. ä½ç½®ç¼–ç çš„ä½œç”¨æ˜¯ï¼Ÿ</div>
                <div class="quiz-options">
                    <label class="quiz-option">
                        <input type="radio" name="ch04q4" value="0" class="quiz-radio">
                        <span>å¢åŠ è¯æ±‡é‡</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q4" value="1" class="quiz-radio">
                        <span>è®©æ¨¡å‹æŒæ¡è¯è¯­çš„é¡ºåº</span>
                    </label>
                    <label class="quiz-option">
                        <input type="radio" name="ch04q4" value="2" class="quiz-radio">
                        <span>æé«˜è®¡ç®—é€Ÿåº¦</span>
                    </label>
                </div>
                <button class="submit-quiz-btn">æäº¤ç­”æ¡ˆ</button>
                <div class="quiz-feedback"></div>
            </div>
        </div>

        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <div style="text-align: center; margin-top: 40px; margin-bottom: 20px;">
            <a href="../index.html" class="back-btn" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 8px; font-weight: 500;">
                <span>ğŸ </span>
                <span>è¿”å›è¯¾ç¨‹é¦–é¡µ</span>
            </a>
        </div>

        <!-- ç¤¾äº¤åˆ†äº« -->
        <div class="share-buttons">
            <a href="#" class="share-btn share-wechat" data-share-type="wechat">
                <span>ğŸ’¬</span>
                <span>åˆ†äº«åˆ°å¾®ä¿¡</span>
            </a>
            <a href="#" class="share-btn share-weibo" data-share-type="weibo">
                <span>ğŸ“±</span>
                <span>åˆ†äº«åˆ°å¾®åš</span>
            </a>
            <a href="#" class="share-btn share-copy" data-share-type="copy">
                <span>ğŸ”—</span>
                <span>å¤åˆ¶é“¾æ¥</span>
            </a>
        </div>
    </main>

    <script src="../js/main.js"></script>
    <script>
        // è‡ªæ³¨æ„åŠ›å¯è§†åŒ–
        const sentence = ['æˆ‘', 'çˆ±', 'åƒ', 'è‹¹æœ'];
        const attentionWeights = {
            'æˆ‘': [0.8, 0.1, 0.05, 0.05],
            'çˆ±': [0.3, 0.5, 0.15, 0.05],
            'åƒ': [0.1, 0.2, 0.4, 0.3],
            'è‹¹æœ': [0.05, 0.05, 0.3, 0.6]
        };

        function renderSentence() {
            const container = document.getElementById('sentence');
            container.innerHTML = '';

            sentence.forEach((word, idx) => {
                const span = document.createElement('span');
                span.textContent = word;
                span.dataset.idx = idx;
                span.style.cssText = `
                    padding: 10px 18px;
                    background: white;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 500;
                    border: 2px solid var(--border-color);
                    transition: all 0.2s;
                `;

                span.addEventListener('click', () => showAttention(idx));
                span.addEventListener('mouseenter', () => {
                    span.style.borderColor = 'var(--primary-color)';
                    span.style.background = 'rgba(37, 99, 235, 0.1)';
                });
                span.addEventListener('mouseleave', () => {
                    if (parseInt(span.dataset.idx) !== currentSelected) {
                        span.style.borderColor = 'var(--border-color)';
                        span.style.background = 'white';
                    }
                });

                container.appendChild(span);
            });
        }

        let currentSelected = -1;

        function showAttention(idx) {
            currentSelected = idx;
            const weights = attentionWeights[sentence[idx]];
            const barsContainer = document.getElementById('attentionBars');
            barsContainer.innerHTML = '';

            // æ›´æ–°è¯è¯­æ ·å¼
            document.querySelectorAll('#sentence span').forEach((span, i) => {
                if (i === idx) {
                    span.style.borderColor = 'var(--primary-color)';
                    span.style.background = 'rgba(37, 99, 235, 0.2)';
                } else {
                    span.style.borderColor = 'var(--border-color)';
                    span.style.background = 'white';
                }
            });

            // åˆ›å»ºæ³¨æ„åŠ›æŸ±
            const colors = ['#2563eb', '#7c3aed', '#06b6d4', '#10b981'];

            sentence.forEach((word, i) => {
                const weight = weights[i];
                const bar = document.createElement('div');
                bar.style.cssText = `
                    flex: 1;
                    background: linear-gradient(to top, ${colors[i]}, ${colors[i]}88);
                    border-radius: 6px 6px 0 0;
                    position: relative;
                    transition: height 0.3s ease;
                    height: ${weight * 150}px;
                    min-height: 30px;
                `;

                const label = document.createElement('div');
                label.textContent = word;
                label.style.cssText = `
                    position: absolute;
                    bottom: -25px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 0.85rem;
                    font-weight: 500;
                `;

                const weightLabel = document.createElement('div');
                weightLabel.textContent = (weight * 100).toFixed(0) + '%';
                weightLabel.style.cssText = `
                    position: absolute;
                    top: -20px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-size: 0.8rem;
                    color: var(--text-secondary);
                `;

                bar.appendChild(label);
                bar.appendChild(weightLabel);
                barsContainer.appendChild(bar);
            });
        }

        renderSentence();
        showAttention(3); // é»˜è®¤é€‰ä¸­"è‹¹æœ"

        // ç« èŠ‚æµ‹éªŒé€»è¾‘
        const ch04QuizAnswers = {
            'ch04-quiz-1': { correct: '1', explanation: 'æ­£ç¡®ï¼Transformerçš„æ ¸å¿ƒåˆ›æ–°æ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆSelf-Attentionï¼‰ã€‚å®ƒè®©æ¨¡å‹èƒ½å¤ŸåŒæ—¶å…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„æ‰€æœ‰ä½ç½®ï¼Œæ•æ‰é•¿è·ç¦»ä¾èµ–å…³ç³»ï¼Œè¿™æ˜¯ç›¸å¯¹äºRNNçš„é©å‘½æ€§çªç ´ã€‚' },
            'ch04-quiz-2': { correct: '1', explanation: 'æ­£ç¡®ï¼Transformerç›¸æ¯”RNNçš„ä¸»è¦ä¼˜åŠ¿æ˜¯å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚RNNéœ€è¦é¡ºåºå¤„ç†æ¯ä¸ªè¯ï¼Œè€ŒTransformerå¯ä»¥åŒæ—¶å¤„ç†æ•´ä¸ªåºåˆ—ï¼Œé€Ÿåº¦å¤§å¤§æå‡ã€‚' },
            'ch04-quiz-3': { correct: '1', explanation: 'æ­£ç¡®ï¼å¤šå¤´æ³¨æ„åŠ›è®©æ¨¡å‹ä»å¤šä¸ªä¸åŒè§’åº¦åŒæ—¶åˆ†æä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¤´å…³æ³¨è¯­æ³•å…³ç³»ï¼Œå¦ä¸€ä¸ªå¤´å…³æ³¨è¯­ä¹‰å…³è”ï¼Œå°±åƒç”¨å¤šç›ç¯ç…§äº®ä¸åŒè§’è½ã€‚' },
            'ch04-quiz-4': { correct: '1', explanation: 'æ­£ç¡®ï¼ä½ç½®ç¼–ç è®©æ¨¡å‹æŒæ¡è¯è¯­çš„é¡ºåºã€‚ç”±äºTransformeræœ¬è´¨ä¸Šæ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œéœ€è¦é¢å¤–æ³¨å…¥ä½ç½®ä¿¡æ¯ï¼Œæ‰èƒ½ç†è§£è¯è¯­çš„å…ˆåé¡ºåºã€‚' }
        };

        document.querySelectorAll('.submit-quiz-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const container = btn.closest('.quiz-container');
                const selected = container.querySelector('.quiz-radio:checked');
                const feedback = container.querySelector('.quiz-feedback');
                const options = container.querySelectorAll('.quiz-option');

                if (!selected) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ');
                    return;
                }

                const quizId = container.getAttribute('data-quiz-id');
                const quiz = ch04QuizAnswers[quizId];

                feedback.classList.remove('correct', 'incorrect');
                feedback.classList.add('show');

                if (selected.value === quiz.correct) {
                    feedback.classList.add('correct');
                    feedback.innerHTML = `<strong>âœ“ å›ç­”æ­£ç¡®ï¼</strong><p>${quiz.explanation}</p>`;
                    options.forEach(opt => {
                        if (opt.querySelector('.quiz-radio').value === quiz.correct) {
                            opt.classList.add('correct');
                        }
                    });
                } else {
                    feedback.classList.add('incorrect');
                    feedback.innerHTML = `<strong>âœ— å›ç­”é”™è¯¯</strong><p>${quiz.explanation}</p>`;
                    options.forEach(opt => {
                        if (opt.querySelector('.quiz-radio').value === quiz.correct) {
                            opt.classList.add('correct');
                        } else if (opt.querySelector('.quiz-radio').checked) {
                            opt.classList.add('incorrect');
                        }
                    });
                }

                btn.disabled = true;
                btn.textContent = 'å·²å®Œæˆ';
            });
        });
    </script>
</body>
</html>
